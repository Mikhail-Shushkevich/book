<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Keyboard</title>
  </head>
  <body>
    <!-- События клавиатуры -->
    <!-- Создаем холст - задаем размеры -->
    <canvas id="canvas" width="400" height="400"></canvas>
    <!-- Подключаем фреймворк -->
    <script src="/jquery-3.7.1.js"></script>
    <script>
      // Настройка холста
      // Сначала нам нужно найти элемент canvas и получить контекст рисования.
      let canvas = document.getElementById("canvas");
      let ctx = canvas.getContext("2d");
      // Это позволит менять размер холста только в одном месте
      let width = canvas.width;
      let height = canvas.height;

      // 2. Перевод кодов в названия с помощью объекта
      // Создадим объект keyNames, ключи которого соответствуют кодам клавиш, а значение - их англоязычным названиям.
      let keyNames = {
        87: "w", //вверх
        83: "s", //вниз
        65: "a", //влево
        68: "d", //вправо
        32: "space", //стоп
      };

      // 1. Добавим обработчик событий keydown
      // Используем jQuery - функцию $ для поиска HTML-элемента body, вызвав метод keydown. Аргумент этого метода - функция,
      // которая будет вызываться при каждом нажатии клавиши. Информация о событии передается в функцю через объект event.
      // В данном случаи мы хотим узнать, какая клавиша была нажата, и эти сведения хранятся в свойстве keyCode объекта event.
      $("body").keydown(function (event) {
        // В теле функции мы используем console.log, чтобы вывести значение свойства keyCode: это число, соответствующее нажатой клавише.
        // Каждой из клавиш соответсвует уникальный числовой код, например код клавиши пробел равен 32, а код стрелки влево - 37.
        console.log(event.keyCode);
      });

      //   // Реакция на отпускание клавиш (keyup) — останавливаем мяч
      //   $("body").keyup(function (event) {
      //     let direction = "stop"; // Устанавливаем состояние "стоп" при отпускании клавиши
      //     ball.setDirection(direction);
      //   });

      // 3. Управляем мячом с клавиатуры
      // Функция circle
      // х и у - координаты, radius - радиус окружности, fillCircle - булевый флаг. Если true, круг будет заполнен цветом.
      // Если false, круг будет просто обведен.
      let circle = function (x, y, radius, fillCircle) {
        console.log("fillCircle is:", fillCircle);
        ctx.beginPath(); // Начинает новый путь для рисования
        ctx.arc(x, y, radius, 0, Math.PI * 2, false); // Создает дугу, которая становится кругом:
        // Рисует круг с центром в точке (x, y) и заданным радиусом. 0 и Math.PI * 2 задают начало и конец угла,
        // чтобы нарисовать полный круг (360°). Последний параметр false указывает направление рисования по часовой стрелке
        if (fillCircle) {
          ctx.fill(); // Если fillCircle === true, вызывается ctx.fill(), чтобы закрасить круг.
        } else {
          ctx.stroke(); // Если fillCircle === false, вызывается ctx.stroke(), чтобы просто нарисовать контур круга.
        }
      };

      // Создаем конструктор Ball
      let Ball = function () {
        // В данных двух строках можно менять начальную позицию мяча:
        // this.x = 0; this.y = 0 - левый верхний угол.
        // this.x = 0; this.y = height - левый нижний угол.
        // this.x = width; this.y = 0 - правый верхний угол.
        // this.x = width; this.y = height - правый нижний угол.
        // Но так же можно указывать координаты х и у цифрами. К примеру:
        // this.x = 20; this.y = 380; - мячь будет находиться в нижнем левом углу с небольшими отступами
        this.x = width / 2; // width / 2 означает, что начальная позиция мяча по X будет в середине холста.
        this.y = height / 2; // height / 2 означает, что начальная позиция мяча по Y будет в середине холста.
        this.xSpeed = 0; //
        this.ySpeed = 0; //
      };
      // Создаем метод move
      Ball.prototype.move = function () {
        this.x += this.xSpeed; // Эта строка говорит: "Увеличь (или уменьшай) текущее положение объекта по оси X на значение его скорости xSpeed."
        this.y += this.ySpeed; // Аналогично, эта строка увеличивает (или уменьшает) текущее положение объекта по оси Y на значение его скорости ySpeed.
        // Этот блок проверяет, не вышел ли мяч за пределы холста по горизонтали (оси X):
        // Если мяч выходит за левую границу экрана (то есть его позиция по оси X становится меньше нуля),
        // то он появляется с правой стороны экрана: this.x = width;.
        // Если мяч выходит за правую границу экрана (то есть его позиция по оси X больше ширины экрана),
        // то он появляется с левой стороны экрана: this.x = 0;.
        // Это создаёт эффект "бесконечного" экрана, на котором мяч всегда остается видимым, переходя с одного края экрана на другой.
        if (this.x < 0) {
          this.x = width;
        } else if (this.x > width) {
          this.x = 0;
        }
        if (this.y < 0) {
          this.y = height;
        } else if (this.y > height) {
          this.y = 0;
        }
      };
      // Создаем метод draw
      Ball.prototype.draw = function () {
        circle(this.x, this.y, 10, true);
      };
      //  Создаем метод setDirection
      // Это определение метода setDirection, который будет работать с объектами типа Ball.
      // Метод принимает один параметр — строку direction, которая указывает направление движения.
      Ball.prototype.setDirection = function (direction) {
        // Если значение параметра direction равно "w", это означает, что объект должен двигаться вверх.
        if (direction === "w") {
          // Устанавливается скорость по оси X равной 0 (объект не будет двигаться влево или вправо).
          this.xSpeed = 0;
          // Устанавливается скорость по оси Y равной -5 (объект будет двигаться вверх на 5 пикселей за каждый шаг).
          this.ySpeed = -5;
          // Если значение direction равно "s", объект будет двигаться вниз.
        } else if (direction === "s") {
          // Устанавливается скорость по оси X равной 0.
          this.xSpeed = 0;
          // Устанавливается скорость по оси Y равной 5 (объект будет двигаться вниз на 5 пикселей за каждый шаг).
          this.ySpeed = 5;
          // Если значение direction равно "a", объект будет двигаться влево.
        } else if (direction === "a") {
          // Устанавливается скорость по оси X равной -5 (объект будет двигаться влево на 5 пикселей за каждый шаг).
          this.xSpeed = -5;
          //   Устанавливается скорость по оси Y равной 0 (объект не будет двигаться вверх или вниз).
          this.ySpeed = 0;
          // Если значение direction равно "d", объект будет двигаться вправо.
        } else if (direction === "d") {
          // Устанавливается скорость по оси X равной 5 (объект будет двигаться вправо на 5 пикселей за каждый шаг).
          this.xSpeed = 5;
          // Устанавливается скорость по оси Y равной 0 (объект не будет двигаться вверх или вниз).
          this.ySpeed = 0;
          // Если значение direction равно "stop", объект перестанет двигаться.
        } else if (direction === "stop") {
          // Устанавливаются скорости по обеим осям X и Y равными 0, что означает остановку движения.
          this.xSpeed = 0;
          this.ySpeed = 0;
        }
      };
      // Реакция на нажатие клавиш
      let ball = new Ball();

      let keyActions = {
        87: "w",
        83: "s",
        65: "a",
        68: "d",
        32: "stop",
      };

      // Реакция на нажатие клавиш (keydown)
      $("body").keydown(function (event) {
        let direction = keyActions[event.keyCode];
        ball.setDirection(direction);
      });

      // Вот еще один способ, как сделать так, чтобы при отпускании клавиши - объект не двигался.

      // Реакция на отпускание клавиш (keyup) — останавливаем мяч
      $("body").keyup(function (event) {
        let direction = "stop"; // Устанавливаем состояние "стоп" при отпускании клавиши
        ball.setDirection(direction);
      });

      // Анимация меча
      setInterval(function () {
        ctx.clearRect(0, 0, width, height);
        ball.draw();
        ball.move();
        ctx.strokeRect(0, 0, width, height);
      }, 30);
    </script>
  </body>
</html>
